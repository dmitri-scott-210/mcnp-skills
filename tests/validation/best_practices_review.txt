================================================================================
MCNP BEST PRACTICES REVIEW - generated_gt_mhr.inp
================================================================================

Generated: 2025-10-31
Phase: Problem Setup + Criticality (KCODE problem detected)
Reviewer: Claude Code (MCNP Skills Framework)

This review checks the generated GT-MHR input against the 57-item best practices
checklist from MCNP6 Manual Chapter 3.4 (Setup, Preproduction, Production,
Criticality).

================================================================================
PHASE 1: PROBLEM SETUP (22 items from Chapter 3.4.1)
================================================================================

GEOMETRY (Items 1-7):
--------------------------------------------------------------------------------
[PASS] Item 3: Model in sufficient detail
  - 7-level universe hierarchy implemented
  - TRISO particles with 5 coating layers
  - Double heterogeneity (particles in compacts, compacts in blocks)
  - Appropriate level of detail for GT-MHR full core model

[PASS] Item 4: Use simple cells
  - Most cells use straightforward geometry definitions
  - Lattice cells appropriately use lat=1 and lat=2
  - Minimal use of complex Boolean expressions

[PASS] Item 5: Use simplest surfaces possible
  - Using macrobodies where appropriate: SO, CZ, RPP, HEX, RCC
  - Hexagonal geometry uses HEX macrobody (not 6 individual planes for cells)
  - Fuel block uses 6 P surfaces (standard for hexagonal lattice)

[PASS] Item 6: Avoid excessive complement (#) operator
  - Only 3 uses of # operator (cell 604: #602 #603)
  - Appropriate use for excluding reflector volumes from column void

[WARN] Item 2: ALWAYS plot geometry from multiple angles
  - NOT YET PERFORMED
  - CRITICAL: Must plot before any simulation runs
  - Recommend: mcnp6 ip i=generated_gt_mhr.inp
  - Check XY, XZ, YZ views
  - Look for dashed lines (geometry errors)

[INFO] Item 1: Draw a picture of geometry
  - Assumed completed during design phase (gt_mhr_design_spec.md)
  - 7-level hierarchy documented

[INFO] Item 7: Build geometry incrementally
  - Cannot verify from input file
  - Model was built level-by-level per design spec

INPUT ORGANIZATION (Items 8-9):
--------------------------------------------------------------------------------
[FAIL] Item 9: Pre-calculate masses, volumes, areas
  - NO VOL card in input
  - No documented pre-calculated values
  - RECOMMEND: Add VOL card to verify volumes
  - RECOMMEND: Calculate expected core mass and compare with output

[INFO] Item 8: Use READ card for common cards
  - Not using READ card (all definitions in single file)
  - Acceptable for this model size (292 lines)
  - Could improve maintainability for material definitions

VALIDATION (Items 10-13):
--------------------------------------------------------------------------------
[FAIL] Item 10: Use VOID card when checking geometry
  - VOID card NOT present
  - CRITICAL for initial geometry validation
  - RECOMMEND: Add VOID test before production runs
  - Run with NPS 1000000 to flood geometry

[FAIL] Item 11: Check source with print tables 10, 110, 170
  - NO PRINT card specified
  - Cannot verify source distribution without these tables
  - RECOMMEND: Add "PRINT 10 110" to data cards

[FAIL] Item 12: Check source with mesh tally
  - No FMESH or TMESH tally defined
  - RECOMMEND: Add mesh tally to visualize initial source distribution
  - Helpful for criticality convergence verification

[PASS] Item 13: Be aware of physics approximations
  - Using MODE N (neutron transport only)
  - Appropriate for criticality calculation
  - Thermal scattering (grph.60t) included for all carbon materials

CROSS SECTIONS & TALLIES (Items 14-16):
--------------------------------------------------------------------------------
[INFO] Item 14: Cross-section sets matter
  - Using .66c and .60c libraries (ENDF/B-VI)
  - Will verify in output that all isotopes loaded correctly
  - Consistent with reference model (gt-mhr-pbmr.i)

[N/A] Item 15: Use separate tallies for fluctuation chart
  - No tallies defined (criticality-only problem)
  - Only calculating k-eff
  - If adding tallies, use separate F cards

[PASS] Item 16: Use conservative variance reduction
  - Only using IMP:N cards (basic importance)
  - No complex variance reduction (DXTRAN, weight windows, etc.)
  - Appropriate for initial problem setup

GENERAL (Items 17-22):
--------------------------------------------------------------------------------
[PASS] Item 17: Don't use too many VR techniques
  - Only importance cards used
  - No excessive VR

[N/A] Item 18: Balance user time with computer time
  - Cannot evaluate from input alone
  - Will depend on actual run times

[INFO] Item 19: Study ALL warning messages
  - Will need to review output file
  - No obvious input warnings expected

[FAIL] Item 20: Generate best output (use PRINT card)
  - NO PRINT card specified
  - RECOMMEND: Add "PRINT 10 40 50 110 126"
    - 10: Source information
    - 40: Material table with volume
    - 50: Surface information
    - 110: Activity by cell
    - 126: Criticality summary

[PASS] Item 21: Recheck INP file
  - This review serves that purpose
  - Materials verified against design spec
  - Densities match reference model
  - Source appropriate (KCODE + KSRC)

[INFO] Item 22: Garbage in = garbage out
  - Input constructed from validated design parameters
  - Based on published GT-MHR literature
  - Compared against reference model (gt-mhr-pbmr.i)

================================================================================
PHASE 4: CRITICALITY PROBLEMS (5 items from Chapter 3.4.4)
================================================================================

[PASS] Item 1: Determine inactive cycles needed
  - KCODE specifies 50 inactive (skip) cycles
  - Matches reference model
  - Should verify convergence in output (plot k-eff vs cycle)

[PASS] Item 2: Run large histories per cycle
  - KCODE: 5000 histories per cycle
  - MEETS minimum requirement (>10,000 recommended, >5000 acceptable)
  - Sufficient for production run

[INFO] Item 3: Examine k-eff behavior
  - Will need output file to verify
  - Should check for trends after inactive cycles
  - Plot k-eff and Shannon entropy vs cycle number

[PASS] Item 4: Use at least 100 active cycles
  - KCODE specifies 500 active cycles
  - EXCEEDS minimum (100)
  - Total active histories: 5000 x 500 = 2,500,000

[INFO] Item 5: After run, recheck convergence
  - Will need output file
  - Verify source distribution converged
  - Check that 50 inactive cycles sufficient

================================================================================
PHASE 2 & 3: PREPRODUCTION & PRODUCTION
================================================================================

[N/A] Preproduction (20 items)
  - These checks require running short test calculations
  - Review output files for:
    - Track populations by cell
    - Collisions per source particle
    - FOM (Figure of Merit) stability
    - Statistical checks on tallies (if any)

[N/A] Production (10 items)
  - These checks apply during/after long production runs
  - Will verify in output:
    - FOM stability
    - Relative error convergence (1/sqrt(N))
    - 10 statistical checks passing

================================================================================
SUMMARY
================================================================================

PHASE: Problem Setup (ready for short test runs)

PASSED: 11/22 setup items, 3/5 criticality items
FAILED: 4/22 setup items (critical validation steps)
WARNINGS: 1 (geometry plotting)
N/A: 7 items (require output or post-run analysis)

CRITICAL ITEMS TO ADDRESS BEFORE RUNNING:
--------------------------------------------------------------------------------
1. [CRITICAL] Plot geometry from multiple angles
   Command: mcnp6 ip i=generated_gt_mhr.inp
   Check: XY, XZ, YZ views for dashed lines (errors)
   Reference: Chapter 3.4.1 item 2, Chapter 6

2. [CRITICAL] Add VOID card geometry test
   Add to input temporarily: "VOID" in data section
   Run with: NPS 1000000
   Remove after validation passes
   Reference: Chapter 3.2.8, Chapter 3.4.1 item 10

3. [IMPORTANT] Add PRINT card for diagnostics
   Add: PRINT 10 40 50 110 126
   Provides source info, volumes, activity
   Reference: Chapter 3.4.1 item 20

4. [IMPORTANT] Add volume pre-calculation
   Calculate expected core volume by hand
   Add VOL card to compare MCNP calculation
   Major discrepancies indicate geometry errors
   Reference: Chapter 3.4.1 item 9

GOOD PRACTICES ALREADY FOLLOWED:
--------------------------------------------------------------------------------
[PASS] Appropriate geometry detail (7-level hierarchy)
[PASS] Simple cell definitions (minimal complex Boolean)
[PASS] Macrobody surfaces where possible (HEX, RCC, RPP, SO, CZ)
[PASS] Minimal complement operators (only 3 uses)
[PASS] Conservative variance reduction (IMP only)
[PASS] Thermal scattering for all graphite (grph.60t)
[PASS] Sufficient KCODE parameters (5000/1.0/50/500)
[PASS] Large number of active cycles (500, exceeds min of 100)
[PASS] Adequate histories per cycle (5000, meets requirements)
[PASS] Multiple initial source points (3 KSRC positions)
[PASS] Outside world defined with imp:n=0

RECOMMENDATIONS FOR IMPROVEMENT:
--------------------------------------------------------------------------------
1. Add mesh tally (FMESH) to visualize source distribution
2. Add PRINT cards for comprehensive output diagnostics
3. Add VOL card to verify calculated volumes
4. Consider READ card for material definitions if reusing
5. Document pre-calculated core mass/volume
6. Run short test (10k histories) before full production
7. Plot k-eff vs cycle and Shannon entropy to verify convergence
8. Check all warning messages in output carefully

NEXT STEPS:
--------------------------------------------------------------------------------
1. [NOW] Plot geometry: mcnp6 ip i=generated_gt_mhr.inp
2. [NOW] Add PRINT card: PRINT 10 40 50 110 126
3. [TEST] Add VOID card, run with NPS 1000000
4. [TEST] Remove VOID, run short test (10k histories)
5. [VERIFY] Check output for warnings and errors
6. [VERIFY] Plot k-eff convergence
7. [PRODUCTION] If all tests pass, run full KCODE (2.5M histories)

OVERALL ASSESSMENT:
--------------------------------------------------------------------------------
The generated GT-MHR input file follows most critical best practices for
geometry definition, material specification, and criticality setup. The model
is well-structured with appropriate use of universes, lattices, and surfaces.

However, several CRITICAL validation steps must be performed before this input
can be considered production-ready:
  - Geometry plotting (ESSENTIAL)
  - VOID card testing (ESSENTIAL)
  - Diagnostic output (PRINT cards)
  - Volume verification

The input is ready for validation testing but should NOT be used for production
runs until the above critical items are addressed and verified.

CONFIDENCE LEVEL: Ready for validation testing
PRODUCTION READY: NO (pending geometry plot + VOID test)

================================================================================
END OF BEST PRACTICES REVIEW
================================================================================
