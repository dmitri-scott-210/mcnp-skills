---
title: "Appendix E.8 - Parameter Study and Uncertainty Analysis Tool"
chapter: "E.8"
source_pdf: "mcnp631_theory_user-manual/appendecies/E.8_Parameter_Study_and_Uncertainty_Analysis_Tool_.pdf"
conversion_date: "2025-10-30"
converted_by: "Docling MCP Server + Claude"
notes: "Converted from MCNP6.3.1 documentation"
---

## E.8 Parameter Study and Uncertainty Analysis Tool ( mcnp \_ pstudy.pl )

The mcnp \_ pstudy.pl utility is a Perl script developed to automate the
setup, execution, and collection of results from a series of MCNP code
calculations [356]. This tool provides a convenient means of performing
parameter studies, total uncertainty analyses, parallel job execution on
clusters, stochastic geometry modeling, and other types of calculations
where a series of MCNP calculations must be performed with varying
problem input specifications.

## E.8.1 User Interface

To run this script, the user must have Perl available on their system.
All direct interactions with it are performed in a command-line
interface.

## Syntax for Symbolic Parameters and Options

The mcnp \_ pstudy.pl utility performs various tasks based on a
particular syntax it expects to encounter within the MCNP input file.
All symbolic parameters, instructions, and options interpreted by mcnp \_
pstudy.pl appear as a general comment card ( C , see §4.4.3) followed by
a space, three at signs ( @ ), another space, and the specific command
defining an action taken by the code. Listing E.9 shows a variety of
ways this syntax can be used.

```
1 c @@@ symbol = value 2 c @@@ symbol = value _ 1 value _ 2 ... value _ n 3 c @@@ symbol = normal n mean standard _ deviation 4 c @@@ symbol = lognormal n mean standard _ deviation 5 c @@@ symbol = uniform n lower _ bound upper _ bound 6 c @@@ symbol = beta n alpha beta 7 c @@@ symbol = repeat n 8 c @@@ symbol = ( expression ) 9 c @@@ constraint = ( logical-expression ) 10 c @@@ tied = list-of-symbols 11 c @@@ options = list-of-command-line-options 12 c @@@ options = list-of-command-line-options \ 13 c @@@ list-of-command-line-options
```

Listing E.9: Syntax expected by mcnp \_ pstudy.pl

The keywords on the left-hand side of the equalities in Listing E.9 lead
to various actions and are defined in the following fashion:

| symbol     | A user-defined symbolic parameter or variable name that can be used elsewhere in the MCNP input file to be substituted by a value, or can be used within an expression such as those shown on lines 8 and 9.   |
|------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| constraint | A literal used to define a logical-expression constraining the resulting values of a symbol or a combination of symbols.                                                                                       |
| tied       | Aliteral used to associate multiple symbolic parameters to each other when expanding the full combination of resulting values of the listed symbols.                                                           |
| options    | A literal used to define various command-line options as an alternative to directly specifying them on the command line.                                                                                       |

Some notes on valid syntax on the right-hand side of the equalities in
Listing E.9:

- For values defining a symbol (lines 1-2), strings with embedded whitespace are not allowed.
- The normal , lognormal , uniform , and beta (lines 3-6) represent built-in probability density functions (PDFs) used to sample random values from a respective PDF.
- The repeat n option (line 7) creates a list of integers 1..n . This is a convenient way to create a dummy variable for the purpose of repeating a calculation.
- The n integer value (lines 3-7) is the number of values generated by the specified functions. This count can either be a single integer or a previously defined symbol that is also an integer.
- All parameters, including value , mean , standard \_ deviation , lower \_ bound , upper \_ bound , alpha , and beta , (lines 1-7) can be defined in terms of any previously defined symbol.
- An expression (line 8) may include arithmetic, previously defined symbols, and nested parentheses. The outer set of parentheses is required. The result must be a single scalar value.
- A logical-expression (line 9) may include previously defined symbols, nested parentheses, logical operators, and constants. The outer set of parentheses is required. The result must be true or false.
- A list-of-symbols (line 10) to tie together symbolic parameters must have the same number of values.
- A list-of-command-line-options (line 11-13) may be specified within the input file rather than from the command line. Options are set once, at the beginning of the setup, except for -inner and -outer which take effect immediately for subsequent parameter specifications. Command line options are discussed in §E.8.1.
- Any of the c @@@ lines can be continued by ending the line with a backslash character (line 12). The subsequent continuation line(s) start with c @@@ (line 13).

## Command Line Arguments and Options

After defining parameters, expressions, and/or execution options within
an MCNP input file, as described in §E.8.1, the typical workflow for
using mcnp \_ pstudy.pl is:

1. Setup the full set of parameterized MCNP input files as individual cases ready to be executed. The original MCNP input file is retained and all individual cases are written with a unique filename or within a unique subdirectory location.
2. Run or submit each of the cases through the MCNP executable.
3. Collect results of the ensemble of cases after execution has completed. Note that averaging results across various input parameters may not be very meaningful depending on the application.

## Execution Mode Flags

## Setup jobs

- -setup Individual case input files will be created in a directory structure where each case will be placed in a unique directory. The directory and input file naming is specified

by $ JOBDIR / $ CASE $ N / $ JOB , where each component of the full path
and name can be set through the -jobdir , -case , and -job command line
options described in §E.8.1. The $ N value is a sequence of integers, a
unique integer for each case, that contains $ CASENUM digits padded on
the left with 0 .

-whisper , -inponly Individual case input files will be created in the
current working directory with a unique input file naming specified by
inp \_ $ CASE $ N , where the components of this filename can be
specified through the -case command line option described in §E.8.1. The
$ N value is a sequence of integers, a unique integer for each case,
that contains $ CASENUM digits padded on the left with 0 . The
run/submit jobs and collect results options described below are
incompatible with this execution mode. This option is suitable for other
tools, such as Whisper, to make use of the individual cases created by
mcnp \_ pstudy.pl in this flattened directory structure.

Only a single setup option should be used on the command line. If the
-whisper / -inponly flags are used along with the -setup flag, the code
will default to the -whisper / -inponly behavior.

## Run/submit jobs

| -run      | Execute the setup jobs on the current machine.                                                                              |
|-----------|-----------------------------------------------------------------------------------------------------------------------------|
| -rerun    | Rerun any jobs that did not run to completion and produce a case _ finished file.                                           |
| -submit   | Submit the jobs using the SLURM ( sbatch ), MOAB ( msub ), or LSF ( bsub ) job schedulers. SLURM ( sbatch ) is the default. |
| -resubmit | Resubmit any jobs which did not run to completion and produce a case _ finished file.                                       |
| -status   | Report status from the file system whether cases are running or completed.                                                  |

Of the four run/submit options, -run , -rerun , -submit , and -resubmit
, only a single option should be used on the command line at once. If
multiple run/submit flags are specified at once, only a single one will
be executed based on the ordering of the run/submit flags shown above
regardless of the ordering of the flags on the command line itself.

The -status flag simply checks on the existence of a sentinel file named
case \_ finished within each case directory. At the completion of the
MCNP calculation, mcnp \_ pstudy.pl creates this sentinel file solely for
the purpose of this status check and/or use of the -rerun and -resubmit
flags.

## Collect results

| -collect   | Collect results from each job and average them.   |
|------------|---------------------------------------------------|
| -avgonly   | Only print the average results.                   |

The collection of results requires that a MCTAL is produced. See PRDMP .

## Keyword-value Arguments and Option Flags

## Required keyword-value arguments

-i INFILE The template MCNP input file with variable, expression, and/or
option directives specified for mcnp \_ pstudy.pl . The only alternative
to specifying this keywordargument pair is to stream in the input file
via the standard input ( stdin ).

## Optional keyword-value arguments

| -jobdir JOBDIR               | Use directory $ JOBDIR to store case inputs and results. Can be absolute or relative, and will be created if it does not exist. Default is the local working directory.                                                                                                                 |
|------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| -case CASE                   | Use name $ CASE within case names used to uniquely identify individual jobs. Default is the string case .                                                                                                                                                                               |
| -casenum CASENUM             | Use $ CASENUM digits appended to the case name, e.g., case0001 , case0002 , etc., when $ CASENUM is 4 . Case numbers are padded on the left with 0 . Default is 3 digits.                                                                                                               |
| -job JOB                     | MCNP input filename $ JOB , created in each directory. Default is the string inp .                                                                                                                                                                                                      |
| -log LOGFILE                 | Writes the summary of some of the actions completed and some results collected by mcnp _ pstudy.pl . Default is log.txt .                                                                                                                                                               |
| -mcnp MCNP                   | Used as the run command. $ MCNP may be the location of the executable or may be a string of commands in quotes, such as "mpirun -n 4 /usr/local/MCNP6/bin/mcnp6.mpi"                                                                                                                    |
| -mcnp _ opts MCNP _ OPTS     | -mcnp _ opts MCNP _ OPTS                                                                                                                                                                                                                                                                |
|                              | Appended to the MCNP execution command line. May be a series of options in quotes, e.g., "o=outx tasks 4" .                                                                                                                                                                             |
| -sbatch _ opts SBATCH _ OPTS | -sbatch _ opts SBATCH _ OPTS                                                                                                                                                                                                                                                            |
|                              | Set of options for a sbatch command. Only used if the -submit option is invoked. By default, the SLURM sbatch job scheduler is used for submitting jobs.                                                                                                                                |
| -msub _ opts MSUB _ OPTS     | -msub _ opts MSUB _ OPTS                                                                                                                                                                                                                                                                |
|                              | Set of options for a msub command. Only used if the -submit option is invoked. Sets submission command to the MOAB msub job scheduler.                                                                                                                                                  |
| -bsub _ opts BSUB _ OPTS     | -bsub _ opts BSUB _ OPTS                                                                                                                                                                                                                                                                |
|                              | Set of options for a bsub command. Only used if the -submit option is invoked. Sets submission command to the LSF bsub job scheduler.                                                                                                                                                   |
| -ppn PPN                     | Number of processes to run per node (i.e., number of cases to run concurrently per node). Default value is 1 .                                                                                                                                                                          |
| -symlink SYMLINK             | Create symbolic links in each case directory to the listed files. Can use Unix wildcards in filenames. If $ SYMLINK is more than one file, separate list of files by blanks and use double or single quotes around entire list. Only used during the -setup step.                       |
| -cmd _ before CMD _ BEFORE   | -cmd _ before CMD _ BEFORE                                                                                                                                                                                                                                                              |
|                              | Command(s) to run before running the MCNP code. For Windows, $ CMD _ BEFORE should be a single command, inside double quotes if there are blanks. For Mac/Lin- ux/Cygwin, $ CMD _ BEFORE can be a series of commands separated by semicolons, inside double quotes if there are blanks. |

-cmd \_ after CMD \_ AFTER

## Optional Flags

-debug , -verbose , -v Print additional output.

-outer , -inner

If -outer is selected (the default), then jobs are created for all
possible combinations of the parameters defined. The total number of
jobs is the product of the number of times each parameter is specified.

If -inner is selected, the defined parameters are substituted serially.
The total number of jobs is the maximum number of values of a single
parameter across all parameters defined.

## Notes and Suggestions on Common Command Line Uses

While the workflow described above mentions three distinct steps, the
typical usage of mcnp \_ pstudy.pl can often be accomplished in as few as
one or two commands, invoking multiple steps at once. For example,
running the command

```
1 mcnp _ pstudy.pl -i inputfile -setup -run -collect
```

will result in all three steps being completed in order. This single
command line execution approach assumes that the default MCNP6
executable ( mcnp6 ) is found in the users' PATH environment variable on
the local machine.

Note that the -collect step can only be executed once all cases have
finished executing. Therefore, when submitting jobs to a cluster using
one of the job submission scheduler options, it is likely necessary to
separate the setup and execution steps from the collection step. Running
the two commands

```
1 mcnp _ pstudy.pl -i inputfile -inner -mcnp 'mpirun -np 72 /usr/local/MCNP6/bin/mcnp6.mpi' \ 2 -sbatch _ opts '-N 2 -t 60' -setup -submit 3 mcnp _ pstudy.pl -i inputfile -inner -collect
```

does effectively separate these steps. Note that the second command to
collect results will only be successful if all jobs have completed
running. The -status flag can be used to quickly check on if the full
suite of jobs have completed.

Note that if any job directory, case name, case numbering, job name,
inner/outer options are specified in the setup step, they must be
consistent with the command line options for the subsequent run/submit
and collect results steps if they are done during separate calls to mcnp
\_ pstudy.pl . In the second example above, the -inner flag is specified
in both steps so that the result collection step understands how many
cases to collect results from.

Command(s) to run after the MCNP calculation finishes. Run only if the
MCNP calculation completed successfully.

## E.8.2 Examples

## Example 1

The example in Listing E.10 is setup with the intent to study the effect
of independently varying both the mass density and the radius of a bare
highly enriched uranium sphere that is effectively critical in it's
nominal configuration.

```
1 Godiva independent density/radius mcnp _ pstudy 2 c 3 c @@@ options = -outer 4 c @@@ options = -log godiva _ pstudy _ 1.log.txt 5 c 6 c @@@ DEN = 18. 18.74 19. 7 c @@@ RAD = 8. 8.741 9. 8 c 9 c Below is normal MCNP input, with parameters 10 c 11 1 1 -DEN -1 12 2 0 1 13 14 1 so RAD 15 16 kcode 1000 1.0 10 40 17 ksrc 0. 0. 0. 18 imp:n 1 0 19 m1 92235 -94.73 20 92238 -5.27 21 prdmp j j 1
```

Listing E.10: example\_pstudy\_1.mcnp\_pstudy.inp.txt

Some notes on various mcnp \_ pstudy.pl -specific features of the example
input file in Listing E.10:

- Lines 3 and 4 contain options that are specified within the input file that could alternatively be specified on the command line.
- The DEN and RAD variables are defined on lines 6 and 7 as a list of values, each containing three items, which are ultimately substituted into lines 11 and 14, respectively, for each case created.
- Because the -outer flag is specified, a total of nine cases will be setup, executed and compared; one for each unique combination of DEN and RAD values. If the -inner flag were specified, a total of three cases would be setup.
- Line 21 contains a proper PRDMP card that will produce a MCTAL file at the conclusion of each case calculation. With this, the result collection option will work as intended.

To setup, run, and collect the results of all nine cases created from
the templated input file in Listing E.10, the

```
1 mcnp _ pstudy.pl -i example _ pstudy _ 1.mcnp _ pstudy.inp.txt -setup -run -collect
```

command can be used.

## Example 2

The example in Listing E.11 is setup with the intent to study the effect
of varying the mass density and the radius while preserving the total
mass of a bare highly enriched uranium sphere that is effectively
critical in it's nominal configuration. Additionally, an independent set
of nuclear data libraries are studied for the same combination of
selected densities and radii.

```
1 Godiva mass-preserving density/radius and library mcnp _ pstudy 2 c 3 c @@@ options = -outer 4 c @@@ options = -log godiva _ pstudy _ 2.log.txt 5 c 6 c @@@ DEN = 18. 18.74 19. 7 c @@@ RAD = ( 8.741 * (18.74/DEN) ** .333333 ) 8 c 9 c @@@ tied = U235 U238 10 c @@@ U235 = 92235.80c 92235.00c 11 c @@@ U238 = 92238.80c 92238.00c 12 c 13 c Below is normal MCNP input, with parameters 14 c 15 1 1 -DEN -1 16 2 0 1 17 18 1 so RAD 19 20 kcode 1000 1.0 10 40 21 ksrc 0. 0. 0. 22 imp:n 1 0 23 m1 U235 -94.73 24 U238 -5.27 25 prdmp j j 1
```

Listing E.11: example\_pstudy\_2.mcnp\_pstudy.inp.txt

Some notes on various mcnp \_ pstudy.pl -specific features of the example
input file in Listing E.11:

- Lines 3 and 4 contain options that are specified within the input file that could alternatively be specified on the command line.
- The DEN variable is defined on line 6 as a list of three values, ultimately substituted into line 15.
- The RAD variable is defined on line 7 as an expression that requires evaluation based on the DEN value for that case. Each evaluated RAD value is ultimately substituted into line 18.
- Lines 10 and 11 define two more variables, U235 and U238 , containing two material identifiers for two separate nuclear data libraries. The values of these variables for each case will be substituted into lines 23 and 24, respectively.
- Line 9 specifies that the U235 and U238 variables are tied to one another such that the first and second entries will always be together, effectively representing two total values.
- Because the -outer flag is specified, a total of six cases will be setup, executed and compared; one for each unique combination of the three DEN and two U235 / U238 values.
- Line 25 contains a proper PRDMP card that will produce a MCTAL file at the conclusion of each case calculation. With this, the result collection option will work as intended.

1

To setup, run, and collect the results of the nine cases created from
the templated input file in Listing E.11, the mcnp \_ pstudy.pl -i
example \_ pstudy \_ 2.mcnp \_ pstudy.inp.txt -setup -run -collect

command can be used.

## E.8.3 Changelog

## Version 1.0, June 2003

- Original version. References LA-UR-04-0499 [356] and LA-UR-04-2506 [356].

## Version 1.1, December 2008

- Version released with MCNP5-1.51.

## Version 1.2, September 2010

- Version released with MCNP5-1.60.
- Improvements:
- -Allow for perturbed tallies.
- Bug fixes:
- -Minor fixes for parsing tallies.

## Version 1.3, April 2013

- Version released with MCNP6.1.
- New features:
- -Added sampling from a Lognormal( µ, σ ) probability density function.
- -Added sampling from a Beta( α, β ) probability density function.
- -Added ability to run/rerun/submit/resubmit multiple cases per job, running concurrently ( -ppn )
- Improvements:
- -Allow input lines that start with # .
- -Allow tied outer parameters.
- -Added option for status check of msub and bsub submitted jobs.
- -Modifications to permit inner/outer specifications for each parameter.
- Bug fixes:
- -Fix to prevent infinite loop if last line has no end-of-line ( \n ) character.

## Version 1.4, April 2014

- Version released with MCNP6.1.1beta.
- Improvements:
- -Removed symbolic links for dump files named in input. Can be done explicitly in message block.

## Version 1.5, April 2018

- Version released with MCNP6.2.
- New features:
- -New option -whisper or -inponly , to perform setup of input files in the of form inp\_case* in the current directory. This option does not create case* directories. It is incompatible with the various -run and -submit options.
- -Added SLURM capability through the use of -sbatch \_ opts to specify job scheduler parameters. This is the default job scheduler option.
- -Added -cmd \_ before and -cmd \_ after options to specify commands to be executed before and/or after a submitted job.
- Improvements:
- -Check for, and forbid, duplicate symbol definitions. Check for, and forbid, expressions from using any undefined expressions.

## Version 1.6, May 2022

- Version released with MCNP6.3.
- New features:
- -Added README.md Markdown and extracted user information and changelog content to MCNP manual.
- Improvements:
- -Added .pl suffix to utility to identify it as a Perl script.
- Bug fixes:
- -Fixed infinite loop when long inline ( $ ) comment is encountered during long-line splitting logic.
- -Fixed title card splitting issue during long-line splitting logic. The new logic will not split any part of the optional message block nor the title card to avoid producing invalid input files.